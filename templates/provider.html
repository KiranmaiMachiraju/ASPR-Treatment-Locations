<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
    <title>Provider Dashboard</title>
  </head>
  <body>
    {% extends "template.html" %}

{% block content %}
<div class="container-fluid mt-4">

  <h2 class="mb-4 text-metallic">Providers Dashboard — {{ filters.state }}</h2>

  <!-- Back Button -->
  <a href="{{ url_for('provider_start') }}" class="btn btn-metallic mb-3">← Back</a>

  <!-- Filters -->
  <form method="GET" action="{{ url_for('provider') }}" class="row g-3 align-items-center mb-4">
      <input type="hidden" name="state" value="{{ filters.state }}">
      
      <div class="col-auto">
        <label for="city" class="col-form-label text-light">City:</label>
      </div>
      <div class="col-auto">
        <select name="city" id="city" class="form-control">
            <option value="">-- All Cities --</option>
            {% for c in cities %}
                <option value="{{ c }}" {% if filters.city == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
      </div>

      <div class="col-auto">
        <label for="zip" class="col-form-label text-light">Zip:</label>
      </div>
      <div class="col-auto">
        <input type="text" name="zip" value="{{ filters.zip or '' }}" placeholder="Enter ZIP" class="form-control">
      </div>

      <div class="col-auto">
        <button type="submit" class="btn btn-metallic">Filter</button>
      </div>
  </form>

  <!-- Main KPI Card -->
  <div class="card metallic-card p-4 mb-4">
      <h4 class="text-metallic mb-3">State Overview</h4>
      <div class="row">
          <div class="col-md-4"><p class="text-light"><strong>Total Providers:</strong> {{ stats.total_providers }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Flu Available:</strong> {{ stats.total_flu }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>COVID-19 Available:</strong> {{ stats.total_covid }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>PAP Sites:</strong> {{ stats.total_pap_sites }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Prescribing Services:</strong> {{ stats.total_prescribers }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>USG Product:</strong> {{ stats.total_usg_product }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Commercial Product:</strong> {{ stats.total_commercial_product }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Commercial Paxlovid:</strong> {{ stats.total_commercial_paxlovid }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Paxlovid:</strong> {{ stats.total_paxlovid }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>USG Paxlovid:</strong> {{ stats.total_usg_paxlovid }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Lagevrio:</strong> {{ stats.total_lagevrio }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Veklury:</strong> {{ stats.total_veklury }}</p></div>
          <div class="col-md-4"><p class="text-light"><strong>Other Antivirals</strong> {{ stats.total_oseltamivir_generic + stats.total_oseltamivir_suspension + stats.total_oseltamivir_tamiflu + stats.total_baloxavir + stats.total_zanamivir + stats.total_peramivir }}</p></div>
      </div>
  </div>


  <!-- Providers Section -->
  <h3 class="text-light">Providers List</h3>
  {% if providers %}
  <div class="provider-list">
    {% for p in providers %}
    <div class="provider-card">
      <div class="provider-header">
        <h5 class="text-metallic">{{ p.Provider_Name }}</h5>
        <span class="badge badge-metallic">{{ p.State }}</span>
      </div>
      <div class="provider-body">
        <p><strong>City:</strong> {{ p.City }}</p>
        <p><strong>ZIP:</strong> {{ p.Zip }}</p>
        <p><strong>Phone:</strong> {{ p.Public_Phone or '-' }}</p>
        <p><strong>Last Report:</strong> {{ p.Last_Report_Date or '-' }}</p>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-light">No providers found for this selection.</p>
  {% endif %}

</div>

{% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
  </body>
</html>
