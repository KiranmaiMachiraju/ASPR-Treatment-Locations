{% extends "template.html" %}

{% block content %}
<div class="container-fluid mt-4">

  <div class="row">
    <!-- Left Column: Major KPIs / Charts -->
    <div class="col-lg-9">
      <h2 class="mb-4">Provider Dashboard Overview</h2>

      <!-- KPI Cards Row -->
      <div class="row mb-4 g-3">
        <div class="col-md-3">
          <div class="card metallic-card p-3">
            <h5 class="card-title">Total Providers</h5>
            <p class="card-text">{{ kpis.total_providers }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card metallic-card p-3">
            <h5 class="card-title">PAP Sites</h5>
            <p class="card-text">{{ kpis.total_pap_sites }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card metallic-card p-3">
            <h5 class="card-title">Prescribing Services</h5>
            <p class="card-text">{{ kpis.total_prescribers }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card metallic-card p-3">
            <h5 class="card-title">Flu / COVID-19</h5>
            <p class="card-text">{{ kpis.total_flu }} / {{ kpis.total_covid }}</p>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row g-4">
        <div class="col-md-6" style="width: 1500px;">
          <div class="card metallic-card p-3">
            <h5 class="mb-3">Providers per State</h5>
            <canvas id="stateChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: State Selection -->
    <div class="col-lg-3">
      <div class="card metallic-card p-3 mb-4">
        <h4 class="mb-3">Filter by State</h4>
        <form method="POST">
          <div class="form-group mb-3">
            <select class="form-control" name="state" id="state">
              <option value="">-- Choose a state --</option>
              {% for state in states %}
                <option value="{{ state }}">{{ state }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-metallic w-100">View Providers</button>
        </form>
      </div>

      <div class="card metallic-card p-3">
        <h5 class="mb-3">Summary</h5>
        <p>Total Paxlovid: {{ med_rows.paxlovid }}</p>
        <p>Total Lagevrio: {{ med_rows.lagevrio }}</p>
        <p>Total Veklury: {{ med_rows.veklury }}</p>
      </div>
      
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Providers per state
  const stateCtx = document.getElementById('stateChart').getContext('2d');
  new Chart(stateCtx, {
    type: 'bar',
    data: {
      labels: {{ states_chart|tojson }},
      datasets: [{
        label: 'Providers',
        data: {{ providers_chart|tojson }},
        backgroundColor: 'rgba(192,192,192,0.8)'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } }
    }
  });

  // Medication availability
  const medCtx = document.getElementById('medChart').getContext('2d');
  new Chart(medCtx, {
    type: 'pie',
    data: {
      labels: ['Paxlovid', 'Lagevrio', 'Veklury'],
      datasets: [{
        data: [
          {{ med_rows.paxlovid }},
          {{ med_rows.lagevrio }},
          {{ med_rows.veklury }}
        ],
        backgroundColor: [
          'rgba(192,192,192,0.8)',
          'rgba(160,160,160,0.8)',
          'rgba(128,128,128,0.8)'
        ]
      }]
    },
    options: { responsive: true }
  });
</script>
{% endblock %}
