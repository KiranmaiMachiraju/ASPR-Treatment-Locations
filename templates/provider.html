<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static',filename='app.css')}}">
    <title>Hello, world!</title>
  </head>
  <body>
    {% extends "template.html" %}

{% block content %}
<h2>Providers Dashboard — {{ filters.state }}</h2>

<!-- Back Button -->
<a href="{{ url_for('provider_start') }}" class="btn btn-secondary">← Back</a>

<!-- Filters -->
<form method="GET" action="{{ url_for('provider') }}" style="margin-top: 20px;">
    <input type="hidden" name="state" value="{{ filters.state }}">
    
    <label for="city">City:</label>
    <select name="city" id="city">
        <option value="">-- All Cities --</option>
        {% for c in cities %}
            <option value="{{ c }}" {% if filters.city == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
    </select>

    <label for="zip">Zip:</label>
    <input type="text" name="zip" value="{{ filters.zip or '' }}" placeholder="Enter ZIP">

    <button type="submit" class="btn btn-primary">Filter</button>
</form>

<!-- KPI Cards -->
<h3 style="margin-top: 30px;">State KPIs</h3>
<div style="display: flex; flex-wrap: wrap; gap: 15px;">
    {% set kpis = [
        ('Total Providers', stats.total_providers),
        ('Flu Available', stats.total_flu),
        ('COVID-19 Available', stats.total_covid),
        ('USG Product', stats.total_usg_product),
        ('Commercial Product', stats.total_commercial_product),
        ('Paxlovid', stats.total_paxlovid),
        ('Commercial Paxlovid', stats.total_commercial_paxlovid),
        ('USG Paxlovid', stats.total_usg_paxlovid),
        ('Lagevrio', stats.total_lagevrio),
        ('Commercial Lagevrio', stats.total_commercial_lagevrio),
        ('USG Lagevrio', stats.total_usg_lagevrio),
        ('Veklury', stats.total_veklury),
        ('Oseltamivir Generic', stats.total_oseltamivir_generic),
        ('Oseltamivir Suspension', stats.total_oseltamivir_suspension),
        ('Oseltamivir Tamiflu', stats.total_oseltamivir_tamiflu),
        ('Baloxavir', stats.total_baloxavir),
        ('Zanamivir', stats.total_zanamivir),
        ('Peramivir', stats.total_peramivir)
    ] %}
    
    {% for label, value in kpis %}
    <div style="flex: 0 0 200px; background-color: #f5f5f5; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
        <h4 style="margin: 0; font-size: 18px;">{{ value or 0 }}</h4>
        <p style="margin: 5px 0 0 0; font-size: 14px; color: #555;">{{ label }}</p>
    </div>
    {% endfor %}
</div>

<!-- Providers Table -->
<h3 style="margin-top: 40px;">Providers List</h3>
{% if providers %}
<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
    <thead style="background-color: #f0f0f0;">
        <tr>
            <th>Name</th>
            <th>City</th>
            <th>State</th>
            <th>ZIP</th>
            <th>Phone</th>
            <th>Last Report</th>
        </tr>
    </thead>
    <tbody>
        {% for p in providers %}
        <tr>
            <td>{{ p.Provider_Name }}</td>
            <td>{{ p.City }}</td>
            <td>{{ p.State }}</td>
            <td>{{ p.Zip }}</td>
            <td>{{ p.Public_Phone or '-' }}</td>
            <td>{{ p.Last_Report_Date or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No providers found for this selection.</p>
{% endif %}
{% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
  </body>
</html>